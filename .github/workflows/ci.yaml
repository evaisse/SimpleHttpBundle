name: CI

on: [ "pull_request" ]

jobs:
  tests:
    strategy:
      matrix:
        php-versions: [ '7.4' ]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: "Setup PHP"
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-versions }}
          extensions: pcov, composer:v2, phpstan
      - name: "Composer install"
        run: "composer install --no-interaction --no-progress --prefer-dist"
      - name: "Run php -l on all bundle files"
        run: find . -not -path "./vendor/*" -type f -name '*.php' -exec php -l {} \;
      - name: "PHPSTAN"
        run: "phpstan analyse --level=0 --memory-limit=1G ."
      - name: "Run phpunit"
        run: "XDEBUG_MODE=coverage php ./vendor/bin/phpunit --coverage-text --coverage-clover build/logs/clover.xml"
      - name: "Upload coverage results to Coveralls"
        env:
          COVERALLS_REPO_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: "php vendor/bin/coveralls -v"